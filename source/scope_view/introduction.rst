必要なソフトウェアのインストール
================================================

Scope関連ソフトウェアコンポーネントは以下の製品で構成されています。

Scope base
  TwinCAT XAR ランタイムに組み込まれる基本コンポーネントです。特にインストールする追加ソフトウェアはありません。

TF3300 Scope Server
  分散したIPCやOPC UAサーバからのデータを収集して記録するためのゲートウェイソフトウェアです。Beckhoff製のIPC上で動作し、トライアル、または永久ライセンスが必要です。

TE1300 Scope View professional
  TwinCATのランタイムから収集したデータを可視化するソフトウェアです。

TF3300 Scope serverはゲートウェイの機能を果たすためのもので、複数のIPCからのデータを別のIPCで収集するために用います。本ドキュメントでは一般的な使い方である、1:1 での接続 Scope base + TE1300 Scope view professional の組み合わせにでの使い方をご説明します。よって、必要なものとして事前にXAE環境に Scope view Professional ( TE1300 ) をインストールしてください。

.. figure:: assets/2025-12-16-09-35-05.png
  :align: center
  :name: Scope view professional のインストール

より詳しいライセンスによる機能制限、個々の機能一覧については、`Beckhoff社の公式ドキュメント <https://infosys.beckhoff.com/content/1033/tf3300_tc3_scopeserver/182261131.html?id=5640582462045359703>`_ をご参照ください。

必要なライセンス
================================================

次の機能制限がないデータ記録と可視化を行うには TE1300 Scope View professional のライセンスが必要です。

* 1時間を超える長時間記録
* CSVファイル等への Auto Export機能

ターゲットIPCに組み込む場合
  データ収集対象のターゲットIPCにTE1300ライセンスを紐づけます。この場合はターゲットIPCごとに個別にライセンスを購入する必要がありますが、TE1300の機能が同時に利用可能です。

ライセンスドングルに組み込む
  ライセンスドングルにTE1300ライセンスを紐づけます。ドングルはデータ収集対象のIPCに設置して使います。ドングルを取り付けたIPCにのみTE1300の機能が有効になります。この場合はドングルを取り付けたIPCのみTE1300の機能を利用することができます。

`ライセンス有無による機能制限はこちら <https://infosys.beckhoff.com/content/1033/tf3300_tc3_scopeserver/182261131.html?id=5640582462045359703>`_ をご覧ください。

接続構成（外部PCでCSVファイル保存する場合）
================================================

接続構成は、 :numref:`components` の通りです。IPCに接続したXAEが同梱された開発用PC上にTE1300をインストールしておき、接続先のIPCの各種変数をScope viewで可視化することができます。

.. figure:: image/connection.png
    :align: center
    :scale: 70%
    :name: components

    TE1300 接続構成例

.. note::
    IPC内にXAEを同梱している場合は、IPCにTE1300をインストールすればIPC上でScope viewを起動してデータ可視化することができます。

全体の流れ
================================================

全体の流れは次の手順になります。

1. Scope viewプロジェクトを追加します。
2. モーションやPLCモジュールに接続して、変数をScope view内で使える様にDataPoolに登録します。
3. 登録したDataPoolの変数をYT Chartグラフ上に配置します。
4. DataPoolのフラグや変数の条件により記録を開始したりCSVファイルへ出力するタイミングトリガを設定し、出力するCSVファイルの書式を設定します。

これらの設定がすべて終わったら記録を開始します。

.. image:: image/procedure.png
    :align: center
    :scale: 70%

.. figure:: image/tree_view_structure.png
    :align: center
    :scale: 60%

    Scope view全体の設定項目

本書で紹介するScope viewの機能仕様
================================================

本書では、YT Scope viewプロジェクトを用いて次の機能仕様を実現することを目指します。

* 無限にCSVファイルを出力

  PCのストレージ容量が許す限り無限にCSVファイルを保存します。IPC内で動作させて、ここにCSVを保存する事も可能ですが、容量が無くなる事で制御正常に動作しなくなる要因になります。別のPC上でScope Viewプロジェクトを動作させる運用をおすすめします。

* PLCプログラムにより個別のCSVファイルへ保存

  PLCのプログラムにより生成したトリガ条件でCSVを保存することができます。本書では、直動100mmの連続往復動作のモニタリングを行います。
  この例では、PLCのロジックにより往路の inposition 信号のみを取り出してCSVへデータを保存する例についてご説明します。

* CSVへの記録範囲

  CSVへ保存するトリガは一つだけ定義可能です。そのデータが記録される範囲は、前回トリガが発行されてから今回のトリガ発行タイミングまでの全ての期間のデータとなります。
  記録開始トリガを個別に設定することはできません。

  前回のトリガが発行されてから過大な時間が経過した後にトリガが発生した場合は、 :numref:`section_measurement_project_property` で説明する ``Record Time`` で設定する時間分の最新のデータだけが保存されることとなります。

* CSVファイル名

  CSVファイルの保存先フォルダ名称は指定できますが、CSVファイル名は、 ``Export_*.csv`` という名称で、``*`` 部分は保存されるたびに自動的に加算される番号になります。
